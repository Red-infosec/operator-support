<div class="profile-heading-container">
    <div class="body">
        <strong class="profile-heading">Select an Agent</strong>
        <p>Agents are the lifeblood of Operator. Start an agent on any computer to connect it to Operator, allowing you to run security assessments against the machine. Make sure you have permission from the computer owner beforehand.</p>
    </div>
</div>

<ul id="listing" class="horizontal-list"></ul>

<li id="agent-template" class="profile loader-container" style="display:none">
    <div class="description">
        <h3 id="agent-name" class="split"><span class="main"></span><span class="aux"></span></h3>
        <p id="agent-description"></p>
    </div>

    <div id="agent-platforms" class="actions">
    </div>
</li>

<div id="init-plugin">
    <script>
        console.log('Initializing AgentLibrary plugin')
    </script>
</div>

<script>
    $(document).ready(function () {
        let agents = $("#listing")
        agents.empty()
        SETTINGS.account.agents.forEach(a => {
            let template = $('#agent-template').clone()
            template.attr('id', `agent-${a.name}`)
            template.find('#agent-name .main').text(a.name)
            const describe = a.package ? 'Download by clicking a platform below' : 'Built into Operator and requires no download'
            template.find('#agent-description').text(describe)
            template.find('#agent-platforms').append(a.platforms.map(p => a.package
                ? $(`<a href="#" onClick="downloadFile('https://s3.amazonaws.com/operator.payloads/${a.package}/${a.package}-${p}', '${a.package}-${p}')">${p}</a>`)
                : $(`<span>${p}</span>`)))
            template.find('#agent-name .aux').append(a.protocols.map(p => $(`<span>${p}</span>`)))
            template.show()
            agents.append(template)
        })
    })
</script>
